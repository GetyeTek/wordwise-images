name: Generate Educational Video

on:
  workflow_dispatch:

jobs:
  render_video:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      # This step is the one we are fixing
      - name: Install system dependencies
        run: |
          sudo apt-get update
          # Replace libasound2 with libasound2t64
          sudo apt-get install -y libgbm-dev libasound2t64

      - name: Install Node.js dependencies
        run: npm install

      - name: Run the Remotion rendering script
        run: npm run render

      - name: Upload video artifact
        uses: actions/upload-artifact@v4
        with:
          name: video-artifact
          path: output.mp4
